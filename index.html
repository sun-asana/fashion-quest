<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="balance-container" class="fq-balance-widget">
        <div class="fq-coin"></div>
        <span id="balance-val">0</span>
    </div>

    <div id="fq-overlay" class="hidden">
        <div id="fq-modal">
            <h2 id="modal-title"></h2>
            <div id="modal-content"></div>
            <button id="modal-btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
        </div>
    </div>

    <script src="engine.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        function refreshBalance() {
            const el = document.getElementById('balance-val');
            if (el) el.innerText = window.FQ.money;
        }

        // –í—ã–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.onload = refreshBalance;

        window.addEventListener('message', function(event) {
            const data = event.data;
            if (data.type === 'openTask') {
                window.openTask(data.q, data.a, data.m);
            }
        });

        const overlay = document.getElementById('fq-overlay');
        const content = document.getElementById('modal-content');
        const title = document.getElementById('modal-title');
        const btn = document.getElementById('modal-btn');

        window.openTask = function(question, correctAnswer, reward) {
            title.innerText = "Fashion –í–æ–ø—Ä–æ—Å";
            content.innerHTML = `<p>${question}</p><input type="text" id="user-answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç...">`;
            overlay.classList.remove('hidden');
            
            btn.onclick = function() {
                const val = document.getElementById('user-answer').value;
                if(val && val.toLowerCase().trim() === correctAnswer.toLowerCase().trim()) {
                    window.FQ.addMoney(reward);
                    refreshBalance(); // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—É —Å—Ä–∞–∑—É
                    
                    // –í–º–µ—Å—Ç–æ alert —Å–¥–µ–ª–∞–µ–º –º–∞–ª–µ–Ω—å–∫—É—é –∑–∞–¥–µ—Ä–∂–∫—É, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –º–æ–Ω–µ—Ç—ã
                    setTimeout(() => {
                        overlay.classList.add('hidden');
                        window.parent.postMessage({type: 'close'}, '*');
                        // –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–∞–≥–∞–∑–∏–Ω!
                        window.openShop();
                    }, 500);
                } else {
                    alert("–£–ø—Å! –ù–µ–≤–µ—Ä–Ω–æ.");
                }
            };
        };

        window.openShop = function() {
            title.innerText = "–ì–∞—Ä–¥–µ—Ä–æ–±";
            // –í –±—É–¥—É—â–µ–º –º—ã –∑–∞–º–µ–Ω–∏–º —ç—Ç–æ –Ω–∞ —Ç–≤–æ–∏ —Ä–µ–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏
            const items = [
                {id: 'boots', name: '–°—Ç–∏–ª—å–Ω—ã–µ –±–æ—Ç—ã', price: 150},
                {id: 'jacket', name: '–ö–æ–∂–∞–Ω–∫–∞', price: 300}
            ];
            
            let html = `<div class="shop-grid">`;
            items.forEach(item => {
                const isBought = window.FQ.inventory.includes(item.id);
                html += `
                    <div class="shop-item" style="border-bottom: 1px solid #eee; padding: 10px;">
                        <span>${item.name} ‚Äî ${item.price} üí∞</span>
                        <button onclick="buy('${item.id}', ${item.price})" ${isBought ? 'disabled' : ''}>
                            ${isBought ? '–ù–∞–¥–µ—Ç–æ' : '–ö—É–ø–∏—Ç—å'}
                        </button>
                    </div>`;
            });
            html += `</div>`;
            content.innerHTML = html;
            btn.innerText = "–í –∏–≥—Ä—É";
            btn.onclick = () => overlay.classList.add('hidden');
        };

        function buy(id, price) {
            if(window.FQ.buyItem(id, price)) {
                refreshBalance();
                window.openShop();
            } else {
                alert("–ú–∞–ª–æ–≤–∞—Ç–æ –º–æ–Ω–µ—Ç!");
            }
        }
    </script>
</body>
</html>
