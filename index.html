<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="fq-overlay" class="hidden">
        <div id="fq-modal">
            <h2 id="modal-title"></h2>
            <div id="modal-content"></div>
            <div id="modal-footer">
                 <button id="modal-btn">–û–ö</button>
            </div>
        </div>
    </div>

    <script src="engine.js"></script>
    <script>
        // –°–õ–£–®–ê–¢–ï–õ–¨ –ö–û–ú–ê–ù–î –ò–ó GENIALLY
        window.addEventListener('message', function(event) {
            const data = event.data;
            if (data.type === 'openTask') {
                openTask(data.q, data.a, data.m);
            }
        });

        const overlay = document.getElementById('fq-overlay');
        const content = document.getElementById('modal-content');
        const title = document.getElementById('modal-title');
        const btn = document.getElementById('modal-btn');

        window.openTask = function(question, correctAnswer, reward) {
            title.innerText = "Fashion –í–æ–ø—Ä–æ—Å";
            content.innerHTML = `<p>${question}</p><input type="text" id="user-answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç...">`;
            overlay.classList.remove('hidden');
            
            btn.innerText = "–û—Ç–≤–µ—Ç–∏—Ç—å";
            btn.onclick = function() {
                const val = document.getElementById('user-answer').value;
                if(val && val.toLowerCase().trim() === correctAnswer.toLowerCase().trim()) {
                    window.FQ.addMoney(reward);
                    window.openShop(); 
                } else {
                    alert("–£–ø—Å! –ù–µ–≤–µ—Ä–Ω–æ.");
                }
            };
        };

        window.openShop = function() {
            title.innerText = "–ì–∞—Ä–¥–µ—Ä–æ–±";
            const items = [
                {id: 'shoes_1', name: '–ö–µ–¥—ã', price: 100},
                {id: 'top_1', name: '–•—É–¥–∏', price: 200}
            ];
            
            let html = `<p>–¢–≤–æ–π –±–∞–ª–∞–Ω—Å: <b>${window.FQ.money}</b> üí∞</p><div class="shop-grid">`;
            items.forEach(item => {
                const isBought = window.FQ.inventory.includes(item.id);
                html += `
                    <div class="shop-item" style="border: 1px solid #eee; margin: 5px; padding: 10px;">
                        <span>${item.name} (${item.price})</span><br>
                        <button onclick="buy('${item.id}', ${item.price})" ${isBought ? 'disabled' : ''} style="width: auto; margin-top:5px;">
                            ${isBought ? '–ï—Å—Ç—å' : '–ö—É–ø–∏—Ç—å'}
                        </button>
                    </div>`;
            });
            html += `</div>`;
            content.innerHTML = html;
            btn.innerText = "–ó–∞–∫—Ä—ã—Ç—å";
            btn.onclick = () => {
                overlay.classList.add('hidden');
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å —Å–ª–∞–π–¥—É Genially
                window.parent.postMessage('close', '*'); 
            };
        };

        function buy(id, price) {
            if(window.FQ.buyItem(id, price)) {
                window.openShop();
            } else {
                alert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –º–æ–Ω–µ—Ç!");
            }
        }
    </script>
</body>
</html>
