<script>
    // ... (—Å—Ç–∞—Ä—ã–π –∫–æ–¥ refreshBalance –∏ —Å–ª—É—à–∞—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Å—Ç–∞—é—Ç—Å—è) ...

    function openTask(question, correctAnswer, reward, taskImg, shopType) {
        title.innerText = "–ó–∞–¥–∞–Ω–∏–µ";
        document.getElementById('character-preview').style.display = 'none';
        
        // –ï—Å–ª–∏ —É—á–∏—Ç–µ–ª—å –¥–æ–±–∞–≤–∏–ª —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ—ë
        let imgHtml = taskImg ? `<img src="${taskImg}" style="max-width:100%; border-radius:10px; margin-bottom:10px;">` : '';
        
        content.innerHTML = `
            ${imgHtml}
            <p style="font-size: 1.1rem; color: #555;">${question}</p>
            <input type="text" id="user-answer" style="width:100%; padding:10px; border: 2px solid #ff4081; border-radius: 10px;" placeholder="–¢–≤–æ–π –æ—Ç–≤–µ—Ç...">
        `;
        overlay.classList.remove('hidden');
        
        btn.onclick = function() {
            const val = document.getElementById('user-answer').value;
            if(val && val.toLowerCase().trim() === correctAnswer.toLowerCase().trim()) {
                window.FQ.addMoney(reward);
                refreshBalance();
                openShop(shopType); // –ü–µ—Ä–µ–¥–∞–µ–º —Ç–∏–ø –º–∞–≥–∞–∑–∏–Ω–∞
            } else {
                alert("–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!");
            }
        };
    }

    function openShop(filterType = 'all') {
        title.innerText = "–í—ã–±–µ—Ä–∏ –Ω–∞–≥—Ä–∞–¥—É";
        document.getElementById('character-preview').style.display = 'block';
        
        // –ù–∞—à —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–µ—â–µ–π
        const allItems = [
            {id: 'top_1', name: '–î–∂–∏–Ω—Å–æ–≤–∫–∞', price: 100, type: 'top'},
            {id: 'top_2', name: '–†–æ–∑–æ–≤–æ–µ —Ö—É–¥–∏', price: 120, type: 'top'},
            {id: 'bottom_1', name: '–î–∂–∏–Ω—Å—ã', price: 150, type: 'bottom'},
            {id: 'bottom_2', name: '–Æ–±–∫–∞', price: 130, type: 'bottom'},
            {id: 'shoes_1', name: '–ö–µ–¥—ã', price: 80, type: 'shoes'},
            {id: 'acc_1', name: '–û—á–∫–∏', price: 50, type: 'acc'}
        ];
        
        // –§–ò–õ–¨–¢–†–ê–¶–ò–Ø: –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–π —Ç–∏–ø (–∏–ª–∏ –≤—Å–µ, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ all)
        const items = filterType === 'all' ? allItems : allItems.filter(i => i.type === filterType);
        
        let html = `<div class="shop-grid">`;
        if (items.length === 0) html += `<p>–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –≤–µ—â–µ–π.</p>`;
        
        items.forEach(item => {
            const isBought = window.FQ.inventory.includes(item.id);
            html += `
                <div class="shop-item">
                    <span><b>${item.name}</b><br><small>${item.price} üí∞</small></span>
                    <button onclick="tryOn('${item.id}', ${item.price}, '${item.type}')" style="background: ${isBought ? '#4CAF50' : '#ff4081'}; color: white; border: none; padding: 8px 15px; border-radius: 10px; cursor: pointer;">
                        ${isBought ? '–ù–∞–¥–µ—Ç—å' : '–ö—É–ø–∏—Ç—å'}
                    </button>
                </div>`;
        });
        html += `</div>`;
        
        content.innerHTML = html;
        btn.innerText = "–í –∏–≥—Ä—É";
        btn.onclick = () => overlay.classList.add('hidden');
    }
</script>
