<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* –î–æ–±–∞–≤–∏–º –Ω–µ–º–Ω–æ–≥–æ —Å—Ç–∏–ª–µ–π –¥–ª—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –∫—É–∫–ª—ã */
        .game-container {
            display: flex;
            align-items: flex-start;
            gap: 20px;
            justify-content: center;
        }
        #character-preview {
            flex-shrink: 0;
            background: #f9f9f9;
            border-radius: 15px;
            overflow: hidden;
            border: 2px dashed #ff4081;
        }
        .shop-content {
            flex-grow: 1;
        }
    </style>
</head>
<body>
    <div id="balance-container" class="fq-balance-widget">
        <div class="fq-coin"></div>
        <span id="balance-val">0</span>
    </div>

    <div id="fq-overlay" class="hidden">
        <div id="fq-modal" style="max-width: 700px; width: 90%;">
            <h2 id="modal-title"></h2>
            
            <div class="game-container">
                <div id="character-preview" style="position: relative; width: 200px; height: 350px;">
                    <img id="base-body" src="assets/body/girl.png" style="position: absolute; top:0; left:0; width: 100%; z-index: 1;">
                    
                    <img id="layer-bottom" src="" style="position: absolute; top:0; left:0; width: 100%; z-index: 2;">
                    <img id="layer-top" src="" style="position: absolute; top:0; left:0; width: 100%; z-index: 3;">
                    <img id="layer-shoes" src="" style="position: absolute; top:0; left:0; width: 100%; z-index: 4;">
                </div>

                <div id="modal-content" class="shop-content"></div>
            </div>

            <button id="modal-btn" style="margin-top: 20px;">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
        </div>
    </div>

    <script src="engine.js"></script>
    <script>
        const overlay = document.getElementById('fq-overlay');
        const content = document.getElementById('modal-content');
        const title = document.getElementById('modal-title');
        const btn = document.getElementById('modal-btn');

        function refreshBalance() {
            document.getElementById('balance-val').innerText = window.FQ.money;
        }

        window.onload = refreshBalance;

        // –°–ª—É—à–∞–µ–º –∫–æ–º–∞–Ω–¥—ã –∏–∑ Genially
        window.addEventListener('message', function(event) {
            if (event.data.type === 'openTask') {
                openTask(event.data.q, event.data.a, event.data.m);
            }
        });

        function openTask(question, correctAnswer, reward) {
            title.innerText = "Fashion –í–æ–ø—Ä–æ—Å";
            // –ü—Ä–∏ –≤–æ–ø—Ä–æ—Å–µ —Å–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª
            document.getElementById('character-preview').style.display = 'none';
            content.innerHTML = `<p>${question}</p><input type="text" id="user-answer" placeholder="–í–∞—à –æ—Ç–≤–µ—Ç...">`;
            overlay.classList.remove('hidden');
            
            btn.onclick = function() {
                const val = document.getElementById('user-answer').value;
                if(val && val.toLowerCase().trim() === correctAnswer.toLowerCase().trim()) {
                    window.FQ.addMoney(reward);
                    refreshBalance();
                    openShop(); // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –º–∞–≥–∞–∑–∏–Ω
                } else {
                    alert("–£–ø—Å! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.");
                }
            };
        }

        function openShop() {
            title.innerText = "–¢–≤–æ–π –≥–∞—Ä–¥–µ—Ä–æ–±";
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∫–∏
            document.getElementById('character-preview').style.display = 'block';
            
            // –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (—É–∫–∞–∂–∏ —Ç—É—Ç —Å–≤–æ–∏ ID –∏–∑ –ø–∞–ø–æ–∫)
            const items = [
                {id: 'top_1', name: '–î–∂–∏–Ω—Å–æ–≤–∫–∞', price: 100, type: 'top'},
                {id: 'bottom_1', name: '–î–∂–∏–Ω—Å—ã', price: 150, type: 'bottom'}
            ];
            
            let html = `<div class="shop-grid">`;
            items.forEach(item => {
                const isBought = window.FQ.inventory.includes(item.id);
                html += `
                    <div style="border-bottom: 1px solid #eee; padding: 10px; display: flex; justify-content: space-between; align-items: center;">
                        <span>${item.name} (${item.price} üí∞)</span>
                        <button onclick="tryOn('${item.id}', ${item.price}, '${item.type}')" style="width: auto; padding: 5px 10px;">
                            ${isBought ? '–ù–∞–¥–µ—Ç—å' : '–ö—É–ø–∏—Ç—å'}
                        </button>
                    </div>`;
            });
            html += `</div>`;
            
            content.innerHTML = html;
            btn.innerText = "–ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–±—Ä–∞–∑";
            btn.onclick = () => {
                overlay.classList.add('hidden');
                window.parent.postMessage({type: 'close'}, '*');
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ—Ä–∫–∏/–ø–æ–∫—É–ø–∫–∏
        function tryOn(id, price, type) {
            if (window.FQ.inventory.includes(id)) {
                // –ï—Å–ª–∏ —É–∂–µ –∫—É–ø–ª–µ–Ω–æ, –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥–µ–≤–∞–µ–º
                document.getElementById('layer-' + type).src = 'assets/clothes/' + type + '/' + id + '.png';
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–æ–∫—É–ø–∞–µ–º
                if (window.FQ.buyItem(id, price)) {
                    refreshBalance();
                    document.getElementById('layer-' + type).src = 'assets/clothes/' + type + '/' + id + '.png';
                    openShop();
                } else {
                    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!");
                }
            }
        }
    </script>
</body>
</html>
